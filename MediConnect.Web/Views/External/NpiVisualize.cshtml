@model MediConnect.Web.Models.NpiResultsPageVM
@{
    ViewData["Title"] = "NPI Visualizations";
    Layout = "_Layout";
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container my-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold text-primary">@ViewData["Title"]</h2>
        <div>
            <a asp-action="NpiSearch" class="btn btn-outline-secondary me-2">‚Üê New Search</a>
            <a asp-action="NpiResults"
               asp-route-FirstName="@Model.FirstName"
               asp-route-LastName="@Model.LastName"
               asp-route-Organization="@Model.Organization"
               asp-route-State="@Model.State"
               asp-route-City="@Model.City"
               asp-route-Taxonomy="@Model.Taxonomy"
               class="btn btn-primary">Back to Results</a>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4 col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light fw-bold">Providers by State</div>
                <div class="card-body" style="height:380px;">
                    <canvas id="stateChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light fw-bold">Top Specialties</div>
                <div class="card-body" style="height:380px;">
                    <canvas id="specChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-light fw-bold">Top Cities</div>
                <div class="card-body" style="height:380px;">
                    <canvas id="cityChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
  const stateLabels = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.StateLabels));
  const stateValues = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.StateValues));
  const specLabels  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.SpecLabels));
  const specValues  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.SpecValues));
  const cityLabels  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.CityLabels));
  const cityValues  = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.CityValues));

  const barOpts = {
    responsive: true,
    maintainAspectRatio: false,
    scales: { y: { beginAtZero: true } },
    plugins: { legend: { display: true, position: 'top' } }
  };

  if (stateLabels.length) {
    new Chart(document.getElementById('stateChart'), {
      type: 'bar',
      data: { labels: stateLabels, datasets: [{ label: 'Providers', data: stateValues }] },
      options: barOpts
    });
  }

  if (specLabels.length) {
    new Chart(document.getElementById('specChart'), {
      type: 'doughnut',
      data: { labels: specLabels, datasets: [{ data: specValues }] },
      options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
    });
  }

  if (cityLabels.length) {
    new Chart(document.getElementById('cityChart'), {
      type: 'bar',
      data: { labels: cityLabels, datasets: [{ label: 'Providers', data: cityValues }] },
      options: barOpts
    });
  }
</script>
